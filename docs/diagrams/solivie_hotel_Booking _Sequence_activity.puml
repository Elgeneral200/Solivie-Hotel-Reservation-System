@startuml Booking Sequence Diagram

skinparam {
  backgroundColor #FFFFFF
  defaultFontName Segoe UI
  defaultFontSize 10
  shadowing true
  shadowingIntensity 15
  
  ParticipantBackgroundColor #FFFFFF
  ParticipantBorderColor #2C3E50
  ParticipantBorderThickness 2
  ParticipantFontColor #2C3E50
  ParticipantFontSize 11
  ParticipantFontStyle bold
  
  ActorBackgroundColor #E3F2FD
  ActorBorderColor #1976D2
  ActorFontColor #2C3E50
  ActorFontSize 11
  ActorFontStyle bold
  
  DatabaseBackgroundColor #F1F8E9
  DatabaseBorderColor #388E3C
  DatabaseFontColor #2C3E50
  DatabaseFontSize 11
  DatabaseFontStyle bold
  
  ArrowColor #2C3E50
  ArrowThickness 1.5
  ArrowFontColor #2C3E50
  ArrowFontSize 9
  
  NoteBackgroundColor #FFF3E0
  NoteBorderColor #FF9800
  NoteFontColor #5D4037
  NoteFontSize 9
  NoteRoundCorner 8
  
  LifeLineBackgroundColor #F5F5F5
  LifeLineBorderColor #BDBDBD
}

title <color:#2C3E50><size:16><b>SOLIVIE HOTEL - BOOKING WORKFLOW SEQUENCE DIAGRAM</b></size></title>

caption <color:#546E7A><i>Complete booking process from search to confirmation</i></caption

actor "Hotel Guest" as User <<Customer>>
participant "Search Interface" as Search <<UI>>
participant "Booking Manager" as BM <<Controller>>
participant "Availability Service" as AC <<Service>>
participant "Shopping Cart" as Cart <<Session>>
participant "Payment Processor" as PP <<Service>>
participant "Payment Gateway" as PG <<External>>
participant "Invoice Generator" as IG <<Service>>
participant "Email Service" as Email <<Service>>
participant "Loyalty Program" as LP <<Service>>
database "Hotel Database" as DB <<PostgreSQL>>

' ============================================
' PHASE 1: ROOM SEARCH & AVAILABILITY
' ============================================

User -> Search: **1. Search Criteria**
note right of User
  <color:#2C3E50><b>Search Parameters</b></color>
  â€¢ Check-in/out dates
  â€¢ Number of guests
  â€¢ Room type preferences
  â€¢ Special requirements
end note

activate Search

Search -> AC: **2. check_availability()**\nâŒš Real-time query
activate AC
note right of AC
  <color:#2C3E50><b>Availability Check</b></color>
  â€¢ Room inventory status
  â€¢ Maintenance schedules
  â€¢ Overbooking prevention
  â€¢ Rate plan validation
end note

AC -> DB: **3. QUERY available_rooms**\nğŸ“Š Database lookup
activate DB

DB --> AC: **4. RETURN rooms_list**\nâœ… Available inventory
deactivate DB

AC --> Search: **5. RETURN filtered_rooms**\nğŸ“‹ Sorted by relevance
deactivate AC

Search --> User: **6. DISPLAY room_options**\nğŸ¯ Interactive results
deactivate Search

' ============================================
' PHASE 2: CART MANAGEMENT
' ============================================

User -> Search: **7. SELECT room**\nâœ¨ Choose preferred option

User -> Cart: **8. add_to_cart()**\nğŸ›’ Add selection
activate Cart

Cart -> DB: **9. INSERT cart_item**\nğŸ’¾ Session persistence
activate DB
DB --> Cart: **10. CONFIRM item_saved**\nâœ… Record created
deactivate DB

Cart --> User: **11. RETURN cart_update**\nğŸ“Š Updated summary
deactivate Cart

User -> Cart: **12. checkout()**\nğŸ’° Proceed to payment
activate Cart

Cart -> BM: **13. initiate_booking()**\nğŸš€ Start booking process
activate BM
note right of BM
  <color:#2C3E50><b>Booking Initiation</b></color>
  â€¢ Validate cart contents
  â€¢ Check user session
  â€¢ Prepare booking data
  â€¢ Generate unique reference
end note

' ============================================
' PHASE 3: AVAILABILITY VALIDATION
' ============================================

BM -> AC: **14. validate_availability()**\nâœ… Double-check rooms
activate AC

AC -> DB: **15. SELECT room_status**\nğŸ” Current availability
activate DB
DB --> AC: **16. RETURN availability_status**\nğŸ“Š Real-time confirmation
deactivate DB

AC --> BM: **17. RETURN validation_result**\nâœ… Rooms confirmed
deactivate AC

' ============================================
' PHASE 4: BOOKING CREATION
' ============================================

BM -> BM: **18. calculate_total()**\nğŸ§® Price computation
note right of BM
  <color:#2C3E50><b>Price Calculation</b></color>
  â€¢ Base room rate
  â€¢ Taxes & fees
  â€¢ Promotions/discounts
  â€¢ Additional services
end note

BM -> DB: **19. INSERT booking_record**\nğŸ’¾ Create booking
activate DB
DB --> BM: **20. RETURN booking_id**\nğŸ« Unique reference: BKG-2023-001
deactivate DB

BM --> Cart: **21. RETURN booking_created**\nâœ… Ready for payment
deactivate BM

Cart --> User: **22. REDIRECT payment_page**\nğŸ’³ Secure payment form
deactivate Cart

' ============================================
' PHASE 5: PAYMENT PROCESSING
' ============================================

User -> PP: **23. submit_payment()**\nğŸ’³ Payment details
note right of PP
  <color:#2C3E50><b>Payment Details</b></color>
  â€¢ Credit/debit card info
  â€¢ Billing address
  â€¢ Security verification
  â€¢ PCI DSS compliance
end note

activate PP

PP -> PG: **24. authorize_payment()**\nğŸ” Secure transaction
activate PG
note right of PG
  <color:#2C3E50><b>Payment Gateway</b></color>
  â€¢ Encryption & security
  â€¢ Fraud detection
  â€¢ Authorization request
  â€¢ Real-time processing
end note

PG --> PP: **25. RETURN transaction_result**\nâœ… Approved: TRX-789012
deactivate PG

PP -> DB: **26. INSERT payment_record**\nğŸ’¾ Save transaction
activate DB
DB --> PP: **27. RETURN payment_id**\nğŸ’° Payment saved: PAY-001
deactivate DB

' ============================================
' PHASE 6: BOOKING CONFIRMATION
' ============================================

PP -> BM: **28. confirm_booking()**\nâœ… Update status
activate BM

BM -> DB: **29. UPDATE booking_status**\nğŸ“Š Set to 'CONFIRMED'
activate DB
DB --> BM: **30. RETURN success**\nâœ… Status updated
deactivate DB

BM -> DB: **31. UPDATE room_availability**\nğŸš« Mark as occupied
activate DB
DB --> BM: **32. RETURN success**\nâœ… Room blocked
deactivate DB

deactivate BM

' ============================================
' PHASE 7: DOCUMENT GENERATION
' ============================================

PP -> IG: **33. generate_invoice()**\nğŸ“„ Create documents
activate IG

IG -> DB: **34. SELECT booking_details**\nğŸ“Š Get complete info
activate DB
DB --> IG: **35. RETURN full_details**\nâœ… All data retrieved
deactivate DB

IG -> IG: **36. create_documents()**\nğŸ¨ Generate PDF/HTML
note right of IG
  <color:#2C3E50><b>Document Creation</b></color>
  â€¢ Invoice with hotel branding
  â€¢ Booking confirmation letter
  â€¢ Terms & conditions
  â€¢ Digital signature
end note

IG -> DB: **37. INSERT invoice_record**\nğŸ’¾ Save invoice
activate DB
DB --> IG: **38. RETURN invoice_id**\nğŸ“„ INV-2023-001
deactivate DB

IG --> PP: **39. RETURN documents**\nğŸ“¦ PDF + HTML versions
deactivate IG

' ============================================
' PHASE 8: LOYALTY PROGRAM
' ============================================

PP -> LP: **40. award_points()**\nğŸ† Calculate rewards
activate LP
note right of LP
  <color:#2C3E50><b>Loyalty Points</b></color>
  â€¢ Points per dollar spent
  â€¢ Tier-based multipliers
  â€¢ Special promotions
  â€¢ Reward calculations
end note

LP -> DB: **41. INSERT loyalty_transaction**\nğŸ’¾ Points record
activate DB
DB --> LP: **42. RETURN transaction_id**\nğŸ† Points awarded
deactivate DB

LP -> DB: **43. UPDATE user_points**\nğŸ“Š Balance adjustment
activate DB
DB --> LP: **44. RETURN new_balance**\nğŸ’° Updated total
deactivate DB

LP --> PP: **45. RETURN confirmation**\nâœ… Points processed
deactivate LP

' ============================================
' PHASE 9: NOTIFICATIONS
' ============================================

PP -> Email: **46. send_confirmation()**\nğŸ“§ Prepare notifications
activate Email

Email -> Email: **47. prepare_email()**\nğŸ¨ Create content
note right of Email
  <color:#2C3E50><b>Email Components</b></color>
  â€¢ Personalized greeting
  â€¢ Booking details table
  â€¢ Hotel information
  â€¢ Attachments (PDF invoice)
  â€¢ Mobile-friendly design
end note

Email -> User: **48. SEND confirmation_email**\nğŸ“¨ Delivery to guest
note right of Email
  <color:#2C3E50><b>Email Contents</b></color>
  â€¢ Booking confirmation
  â€¢ Check-in instructions
  â€¢ Hotel amenities guide
  â€¢ Contact information
  â€¢ Cancellation policy
end note

Email --> PP: **49. RETURN delivery_status**\nâœ… Email queued
deactivate Email

' ============================================
' PHASE 10: COMPLETION
' ============================================

PP --> User: **50. DISPLAY confirmation**\nğŸ‰ Booking complete!
note right of PP
  <color:#2C3E50><b>Confirmation Display</b></color>
  â€¢ Booking reference number
  â€¢ Room assignment details
  â€¢ Check-in/out times
  â€¢ Payment receipt
  â€¢ Next steps
end note

deactivate PP

' ============================================
' SUMMARY NOTES
' ============================================

note over User, DB
  <color:#2C3E50><b>Process Summary</b></size></color>
  
  <b>â±ï¸ Duration:</b> 2-5 seconds real-time
  <b>ğŸ“Š Transactions:</b> 15+ database operations
  <b>ğŸ”— Services:</b> 8+ system integrations
  <b>âœ… Outcome:</b> Confirmed booking with all documents
  
  <b>Security Features:</b>
  â€¢ PCI DSS compliant payment processing
  â€¢ Data encryption at rest and in transit
  â€¢ Audit trail for all transactions
  â€¢ Fraud detection mechanisms
end note

legend right
  | <b>Component Type</b> | <b>Color</b> |
  | Customer/Actor | <color:#1976D2>â–ˆ</color> |
  | User Interface | <color:#2C3E50>â–ˆ</color> |
  | Controller/Manager | <color:#D32F2F>â–ˆ</color> |
  | Service Layer | <color:#388E3C>â–ˆ</color> |
  | External System | <color:#FF9800>â–ˆ</color> |
  | Database | <color:#7B1FA2>â–ˆ</color> |
  | **Status** | **Symbol** |
  | Success | âœ… |
  | Data Storage | ğŸ’¾ |
  | External Call | ğŸ”— |
  | Calculation | ğŸ§® |
end legend

@enduml