@startuml Cancel Booking Activity

skinparam {
  defaultFontName Segoe UI
  defaultFontSize 10
  shadowing true
  shadowingIntensity 30
  backgroundColor #FFFFFF
  roundcorner 5
  
  activity {
    BackgroundColor #FFFFFF
    BorderColor #2C3E50
    BorderThickness 2
    BorderStyle solid
    FontColor #2C3E50
    FontSize 11
    FontStyle bold
    DiamondBackgroundColor #FFFFFF
    DiamondBorderColor #E74C3C
    DiamondBorderThickness 2
    DiamondFontColor #2C3E50
    StartColor #27AE60
    StartBorderColor #27AE60
    EndColor #C0392B
    EndBorderColor #C0392B
    BarColor #3498DB
  }
  
  arrow {
    Color #2C3E50
    Thickness 2
    FontColor #2C3E50
    FontSize 9
    FontStyle italic
  }
  
  note {
    BackgroundColor #FFF3E0
    BorderColor #FF9800
    BorderThickness 1
    BorderStyle solid
    FontColor #5D4037
    FontSize 9
    RoundCorner 8
  }
  
  partition {
    BackgroundColor #F5F7FA
    BorderColor #3498DB
    BorderThickness 2
    BorderStyle solid
    FontColor #2C3E50
    FontSize 12
    FontStyle bold
    RoundCorner 10
    Padding 10
  }
  
  rectangle {
    BackgroundColor #FFFFFF
    BorderColor #B0BEC5
    BorderThickness 1
  }
}

title <color:#2C3E50><size:16><b>SOLIVIE HOTEL - BOOKING CANCELLATION WORKFLOW</b></size></color>

caption <color:#546E7A><i>Complete cancellation process with refund management</i></color>

' ============================================
' PHASE 1: USER INITIATION & SELECTION
' ============================================

|#F8FBFF|<color:#3498DB><b>üîπ USER INITIATION</b></color>|
start
:User authenticates to system;
:Navigates to "My Bookings" section;
note right
  <color:#2C3E50><b>Access Control</b></color>
  ‚Ä¢ Role-based permissions
  ‚Ä¢ Session validation
  ‚Ä¢ Activity logging
end note

|#FFF8E1|<color:#FF9800><b>üî∏ BOOKING SELECTION</b></color>|
:System retrieves user bookings;
:Displays booking dashboard
with status indicators;
:User selects booking for cancellation;
:System loads complete booking details
and history;

' ============================================
' PHASE 2: ELIGIBILITY VALIDATION
' ============================================

|#FFEBEE|<color:#EF5350><b>‚ö†Ô∏è ELIGIBILITY CHECK</b></color>|
:System validates booking status;

if (Status = "CHECKED_IN") then (yes)
  :Display error notification:
  "Cannot cancel after check-in";
  :Suggest early checkout option;
  :Provide hotel contact information;
  stop
else (no)
endif

if (Status = "COMPLETED") then (yes)
  :Display informational message:
  "Stay already completed";
  :Offer review submission option;
  stop
else (no)
endif

if (Status = "CANCELLED") then (yes)
  :Display status message:
  "Booking already cancelled";
  :Show previous cancellation details;
  stop
else (no)
endif

:Calculate time until check-in;
:Retrieve applicable policy rules;

if (Within cancellation window?) then (no)
  |#FFF8E1|
  :Display policy restriction
  with specific details;
  :Offer alternative solutions:
  ‚Ä¢ Date modification
  ‚Ä¢ Room type change
  ‚Ä¢ Future credit;
  stop
else (yes)
  :Eligibility confirmed ‚úÖ;
endif

' ============================================
' PHASE 3: FINANCIAL CALCULATIONS
' ============================================

|#F1F8E9|<color:#4CAF50><b>üí∞ REFUND CALCULATION</b></color>|
:System retrieves pricing details
and cancellation policy;

fork
  :Calculate time-based
  penalty percentage;
  note right
    <color:#2C3E50><b>Penalty Schedule</b></color>
    ‚Ä¢ 14+ days: 10%
    ‚Ä¢ 7-13 days: 30%
    ‚Ä¢ 3-6 days: 50%
    ‚Ä¢ 1-2 days: 75%
    ‚Ä¢ Same day: 100%
  end note
fork again
  :Apply fixed
  cancellation fees;
fork again
  :Calculate processing
  and service charges;
end fork

:Compute final refund amount;
:Generate detailed breakdown
for user review;

' ============================================
' PHASE 4: USER CONFIRMATION
' ============================================

|#F3E5F5|<color:#9C27B0><b>‚úÖ CONFIRMATION PROCESS</b></color>|
:Display comprehensive summary
with visual indicators;

split
  :Show original booking
  amount and details;
split again
  :Display cancellation
  charges breakdown;
split again
  :Show final refund
  amount and timeline;
end split

:User reviews all information;
if (User confirms cancellation?) then (no)
  :Return to bookings dashboard;
  :Log cancellation review
  without action;
  stop
else (yes)
  :Proceed with cancellation
  processing;
endif

:Capture optional cancellation reason;
:Obtain final user confirmation
with digital signature;

' ============================================
' PHASE 5: PROCESSING INITIATION
' ============================================

|#E8EAF6|<color:#3F51B5><b>‚öôÔ∏è PROCESS INITIATION</b></color>|
:System generates unique
cancellation reference ID;
:Set processing timestamp
and audit trail;

fork
  :Update booking status
  to "CANCELLING";
fork again
  :Lock booking record
  for data integrity;
fork again
  :Create backup of original
  booking data;
fork again
  :Initialize cancellation
  workflow log;
end fork

' ============================================
' PHASE 6: SYSTEM UPDATES
' ============================================

|#F1F8E9|<color:#4CAF50><b>üîÑ SYSTEM UPDATES</b></color>|
fork
  partition "Database Operations" {
    :Update booking status
    to "CANCELLED";
    :Set cancellation
    date and time;
    :Update room availability
    status;
    :Clear booked dates
    from calendar;
  }
fork again
  partition "Inventory Management" {
    :Release room inventory
    for rebooking;
    :Update real-time
    availability;
    :Notify revenue
    management system;
    :Recalculate occupancy
    forecasts;
  }
fork again
  partition "Payment Processing" {
    :Validate refund method
    and account details;
    :Connect to secure payment
    gateway API;
    :Initiate refund
    transaction request;
  }
end fork

' ============================================
' PHASE 7: REFUND EXECUTION
' ============================================

|#FFF3E0|<color:#FF9800><b>üí≥ REFUND EXECUTION</b></color>|
:Process refund through
payment gateway;
:Await transaction authorization;

if (Refund successful?) then (no)
  |#FFEBEE|
  :Log failure details
  with error codes;
  :Update status to
  "REFUND_PENDING";
  
  fork
    :Send high-priority alert
    to finance department;
  fork again
    :Create automated
    support ticket;
  fork again
    :Notify customer about
    manual processing;
  end fork
  
  :Display information message
  with contact details;
  stop
else (yes)
  :Record transaction ID
  and confirmation;
  :Update payment status
  to "REFUNDED";
  :Store gateway response
  for audit;
endif

' ============================================
' PHASE 8: LOYALTY PROGRAM
' ============================================

|#E8F5E9|<color:#00C853><b>üèÜ LOYALTY ADJUSTMENTS</b></color>|
if (Loyalty points awarded?) then (yes)
  :Calculate points
  to be reversed;
  :Update user's loyalty
  account balance;
  :Create adjustment
  transaction record;
  :Log points reversal
  in audit trail;
else (no)
  :Skip loyalty adjustments;
  :Log "No points to reverse";
endif

' ============================================
' PHASE 9: NOTIFICATIONS
' ============================================

|#E3F2FD|<color:#2196F3><b>üìß NOTIFICATION SYSTEM</b></color>|
fork
  partition "Customer Communication" {
    :Send cancellation confirmation
    email with attachments;
    :Send refund receipt
    and transaction details;
    :Send optional feedback
    survey request;
  }
fork again
  partition "Internal Alerts" {
    :Notify front desk staff
    via dashboard;
    :Alert housekeeping team
    for schedule updates;
    :Update central reservation
    system records;
    :Notify revenue and
    accounting departments;
  }
fork again
  partition "Audit & Reporting" {
    :Log complete transaction
    in audit system;
    :Update financial reports
    and statements;
    :Generate cancellation
    analytics report;
    :Archive booking data
    for compliance;
  }
end fork

' ============================================
' PHASE 10: COMPLETION
' ============================================

|#F3E5F5|<color:#9C27B0><b>üéâ PROCESS COMPLETION</b></color>|
:Display success screen
with celebration elements;

split
  :Show cancellation
  confirmation details;
split again
  :Display refund information
  and timelines;
split again
  :Provide support contact
  and resources;
end split

:Offer post-cancellation actions:
  ‚Ä¢ Download all documents
  ‚Ä¢ View cancellation policy
  ‚Ä¢ Book alternative stay
  ‚Ä¢ Contact customer service
  ‚Ä¢ Provide feedback;

stop

legend bottom center
  <color:#3498DB>‚ñà</color> <b>USER FLOW</b> | <color:#FF9800>‚ñà</color> <b>SELECTION</b> | <color:#EF5350>‚ñà</color> <b>VALIDATION</b>
  <color:#4CAF50>‚ñà</color> <b>FINANCIAL</b> | <color:#9C27B0>‚ñà</color> <b>CONFIRMATION</b> | <color:#3F51B5>‚ñà</color> <b>PROCESSING</b>
  <color:#00C853>‚ñà</color> <b>LOYALTY</b> | <color:#2196F3>‚ñà</color> <b>COMMUNICATION</b> | <color:#9C27B0>‚ñà</color> <b>COMPLETION</b>
end legend

@enduml